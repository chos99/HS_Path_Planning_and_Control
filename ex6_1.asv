%%
% Author: Kiani Aaron, Wascheck Heiko
% Last changes: 06.Nov.23
close all;

%%
% This file is for nessusary for the exercise 6.1
% Required lab results:

%â€¢ mathematical expressions and values of ğ‘‡_ğ‘– and ğ‘˜_ğ‘Ÿ
%â€¢ Bode diagram of ğº_0 including margins
%â€¢ signal-time-diagram of step response of ğº_ğ‘¤
%â€¢ transfer function ğº_ğ‘…(ğ‘§) of discrete-time PI controller
%â€¢ differences equations to compute I part ğ‘¢_ğ‘–ğ‘˜ = ğ‘¢_ğ‘–(ğ‘˜* ğ‘‡_ğ´) and
%   total manipulation signal ğ‘¢_ğ‘˜ = ğ‘¢(k* ğ‘‡_ğ´) from control deviation ğ‘’_ğ‘˜ = ğ‘¤_ğ‘˜ - ğ‘¦_k
%â€¢ MATLAB script of b. and c. named ex6_1.m
%%
%%
%â€¢ mathematical expressions and values of ğ‘‡_ğ‘– and ğ‘˜_r

% gegeb Ti, 

% Tm = 1000e-3; % close-loop time constant [ s ]
% omega = pi / Tm;
% ts = 0.02;
% numerator = [ts];
% denominator = [2 4];
% 
% sys_DSP = filt(sys_z.numerator, sys_z.denominator, Ts)


%% Heikos Idee:
%inputs:
vmax = 0.5;     % [m/s] die maximale Geschwindigkeit ğ‘£âˆ— als Parameter vmax
x0 = 0;         % [m]   die Startposition ğ‘¥0 als Parameter x0
xs = 1;         % [m]   die zu fahrende BogenlÃ¤nge ğ‘¥âˆ— als Parameter xs
%outputs:
%   - cff:          Polynomialkoeffizienten u_vp1
%   - y_p(t)    	ğ‘¦_ğ‘ = ğ‘¥, wobei ğ‘¥ die gefahrene BogenlÃ¤ngedes Hinterachsmittelpunkts ist.
%   - w_p_dot(t)
%   - w_p_dot_dot(t)

% Parameter definieren
kp = 1;
kr = 0.344014;
ku = P_p_k; 
Ti = 0.246830;
T = P_p_T; 
Tt = P_p_Tt; 
 


[c, te] = cd_refpoly_vmax(vmax, x0, xs)

% Simulationszeit definieren
% von null bis te 
t = 0:0.01:te;


cff = cd_refpoly_ff(c, ku, T, Tt, kr, Ti);  % ist k = P_p_k??? Fragen!


w_p = polyval(cff,t)
figure(3);
w_p_dot = polyder(w_p)
plot(w_p, 'r');
xlabel('Zeit (s)');
ylabel('Amplitude');
title('tbd');
grid on;

% Ãœbertragungsfunktion definieren fÃ¼r Speed Controller und 1/s block = Positions Regler 
numerator = [Ti 1];
denominator = [(Ti*T*Tt)/(kp*kr*ku) (Ti*(T+Tt))/(kp*kr*ku) Ti/kp*(1 + 1/(kr*ku)) (1/kp + Ti) 1];
G_wp = tf(numerator, denominator);

% Systemantwort simulieren
[y_p, t_out] = lsim(G_wp, w_p, t);

%Grafische Darstellung der Ergebnisse
figure(2);
plot(t_out, w_p, 'r', t_out, y_p, 'b--');
xlabel('Zeit (s)');
ylabel('Amplitude');
title('Rampenantwort des kaskadierten Regelkreises');
legend('w_p(t)', 'y_p(t)');
grid on;

figure(3);
w_p_dot = polyder(w_p)
plot(w_p_dot, 'r');
xlabel('Zeit (s)');
ylabel('Amplitude');
title('tbd');
grid on;

figure(4);
w_p_dot_dot = polyder(w_p_dot)
plot(w_p_dot_dot, 'r');
xlabel('Zeit (s)');
ylabel('Amplitude');
title('tbd');
grid on;





